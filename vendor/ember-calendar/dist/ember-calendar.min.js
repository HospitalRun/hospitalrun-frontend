/* ember-calendar 1.0.0 (https://github.com/joinspoton/ember-calendar) | (c) 2013 SpotOn (https://spoton.it) | http://www.opensource.org/licenses/MIT */
Ember.TEMPLATES["ember-calendar"]=Ember.Handlebars.compile("\n  {{view Ember.Calendar.ButtonsView controllerBinding='controller'}}\n  {{view Ember.Calendar.ContainerView controllerBinding='controller'}}\n"),Ember.TEMPLATES["ember-calendar-day"]=Ember.Handlebars.compile("\n\n\n  <div class='ember-calendar-head'>\n    <div class='ember-calendar-head-previous'><button {{action loadPrevious target='controller'}}>&laquo;</button></div>\n    <div class='ember-calendar-head-dates'>\n      {{view Ember.Calendar.HeadingDateView dateBinding='controller.date'}}\n    </div>\n    <div class='ember-calendar-head-next'><button {{action loadNext target='controller'}}>&raquo;</button></div>\n  </div>\n  <div class='ember-calendar-container'>\n    <div class='ember-calendar-body'>\n      {{view Ember.Calendar.HeadingTimesView timesBinding='controller.times'}}\n      <div class='ember-calendar-days'>\n      {{controller.day.length}}\n        {{view Ember.Calendar.DayView eventsBinding='controller.day'}}\n      </div>\n    </div>\n  </div>\n"),Ember.TEMPLATES["ember-calendar-week"]=Ember.Handlebars.compile("\n\n\n  <div class='ember-calendar-head'>\n    <div class='ember-calendar-head-previous'><button {{action loadPrevious target='controller'}}>&laquo;</button></div>\n    {{view Ember.Calendar.WeekHeadingDatesView datesBinding='controller.weekDates'}}\n    <div class='ember-calendar-head-next'><button {{action loadNext target='controller'}}>&raquo;</button></div>\n  </div>\n  <div class='ember-calendar-container'>\n    <div class='ember-calendar-body'>\n      {{view Ember.Calendar.HeadingTimesView timesBinding='controller.times'}}\n      {{view Ember.Calendar.WeekDaysView daysBinding='controller.weekDays'}}\n    </div>\n  </div>\n"),Ember.TEMPLATES["ember-calendar-head-date"]=Ember.Handlebars.compile("\n\n\n  {{view.dateString}}\n"),Ember.TEMPLATES["ember-calendar-head-time"]=Ember.Handlebars.compile("\n\n\n  {{view.timeString}}\n"),Ember.TEMPLATES["ember-calendar-event"]=Ember.Handlebars.compile("\n\n\n  <div class='ember-calendar-event-name'>{{view.nameString}}</div>\n  <div class='ember-calendar-event-time'>{{view.timeString}}</div>\n  <div class='ember-calendar-event-location'>{{view.locationString}}</div>\n"),Ember.TEMPLATES["ember-calendar-button-day"]=Ember.Handlebars.compile("\n\n\n  Day\n"),Ember.TEMPLATES["ember-calendar-button-week"]=Ember.Handlebars.compile("\n\n\n  Week\n"),Ember.Calendar=Ember.Namespace.create(),Ember.Calendar.CalendarController=Ember.ArrayController.extend({startOfWeek:0,startOfDay:8,headingDateFormat:"ddd MMM D",headingTimeFormat:"h a",headingTimeRangeStart:0,headingTimeRangeEnd:24,eventTimeFormat:"h:mm a",eventTimeSeparator:" - ",states:["week"],initialState:"week",presentState:"week",buttonViewClass:"Ember.Calendar.ButtonView",headingTimeViewClass:"Ember.Calendar.HeadingTimeView",eventViewClass:"Ember.Calendar.EventView",weekDayViewClass:"Ember.Calendar.WeekDayView",weekHeadingDateViewClass:"Ember.Calendar.WeekHeadingDateView",multipleStates:function(){return this.get("states").length>1}.property("states"),hasDayState:function(){return-1!==this.get("states").indexOf("day")}.property("states"),hasWeekState:function(){return-1!==this.get("states").indexOf("week")}.property("states"),stateIsDay:function(){return"day"===this.get("presentState")}.property("presentState"),stateIsWeek:function(){return"week"===this.get("presentState")}.property("presentState"),times:function(){var e,t=[];for(e=this.get("headingTimeRangeStart");e<this.get("headingTimeRangeEnd");e++)t.push(36e5*e);return t}.property("headingTimeRangeStart","headingTimeRangeStart"),date:null,day:function(){if(!this.get("date"))return[];var e=[],t=this.get("date").clone(),n=this.get("date").clone().endOf("day");return this.get("content").filter(function(e){return e.end>t&&e.start<=n}).forEach(function(t){var a={};Object.keys(t).forEach(function(e){"start"!==e&&"end"!==e&&(a[e]=t[e])}),a.start=moment(t.start),a.end=moment(n).endOf("day"),a.end>t.end&&(a.end=moment(t.end)),e.push(a)}),e}.property("content","date"),week:null,weekDates:function(){if(!this.get("week"))return[];var e,t=this.get("week").clone().subtract("days",1),n=[];for(e=0;7>e;e++)n.push(t.add("days",1).clone());return n}.property("week"),weekDays:function(){if(!this.get("week"))return[];var e=[[],[],[],[],[],[],[]],t=this.get("weekDates"),n=this,a=t[0].clone(),r=t[6].clone().endOf("day");return this.get("content").forEach(function(t){var i,s,d,l,o=moment(t.start).clone(),m=moment(t.end).clone();if(!(a>=m||o>r))for(;m>o;){for(i={},s=Object.keys(t),d=0;d<s.length;d++)"start"!==s[d]&&"end"!==s[d]&&(i[s[d]]=t[s[d]]);i.start=o.clone(),i.end=o.clone().endOf("day"),i.end>m&&(i.end=m.clone()),l=i.start.clone().startOf("day").diff(n.get("week"),"days"),l>=0&&6>=l&&e[l].push(i),o.add("days",1).startOf("day")}}),e}.property("content","weekDates"),actions:{loadPrevious:function(){"day"===this.get("presentState")?this.set("date",moment(this.get("date").clone().subtract("days",1))):"week"===this.get("presentState")&&this.set("week",moment(this.get("week").clone().subtract("days",7)))},loadNext:function(){"day"===this.get("presentState")?this.set("date",moment(this.get("date").clone().add("days",1))):"week"===this.get("presentState")&&this.set("week",moment(this.get("week").clone().add("days",7)))},changeState:function(e){e!==this.get("presentState")&&("day"===e?(this.set("date",moment(this.get("week"))),this.notifyPropertyChange("date"),this.set("presentState","day")):"week"===e&&(this.set("week",moment(this.get("date")).subtract("days",(moment(this.get("date")).day()+7-this.get("startOfWeek"))%7).startOf("day")),this.notifyPropertyChange("week"),this.set("presentState","week")))}},init:function(){this._super(),-1!==this.states.indexOf("day")&&this.set("date",moment(this.get("initialDate")).startOf("day")),-1!==this.states.indexOf("week")&&this.set("week",moment(this.get("initialDate")).subtract("days",(moment(this.get("initialDate")).day()+7-this.get("startOfWeek"))%7).startOf("day")),this.set("presentState",this.get("initialState"))}}),Ember.Calendar.CalendarView=Ember.View.extend({templateName:"ember-calendar"}),Ember.Calendar.ButtonsView=Ember.ContainerView.extend({classNames:["ember-calendar-buttons"],init:function(){this._super(),this.get("controller.multipleStates")&&(this.get("controller.hasDayState")&&this.pushObject(this.createChildView(Ember.get(this.get("parentView.controller.buttonViewClass")),{buttonState:"day",controller:this.get("controller")})),this.get("controller.hasWeekState")&&this.pushObject(this.createChildView(Ember.get(this.get("parentView.controller.buttonViewClass")),{buttonState:"week",controller:this.get("controller")})))}}),Ember.Calendar.ButtonView=Ember.View.extend({tagName:"button",classNames:["ember-calendar-button"],classNameBindings:["active:ember-calendar-button-active"],templateName:function(){return"ember-calendar-button-"+this.get("buttonState")}.property("buttonState"),templateNameDidChange:function(){this.rerender()}.observes("templateName"),active:function(){return this.get("controller.presentState")===this.get("buttonState")}.property("buttonState","controller.presentState"),click:function(){this.get("active")||this.get("controller").send("changeState",this.get("buttonState"))}}),Ember.Calendar.ContainerView=Ember.View.extend({classNames:["ember-calendar"],templateName:function(){return"ember-calendar-"+this.get("controller.presentState")}.property("controller.presentState"),templateNameDidChange:function(){this.rerender()}.observes("templateName"),didInsertElement:function(){if(-1!==["day","week"].indexOf(this.get("controller.presentState"))){var e=$("#"+this.get("elementId")+" > .ember-calendar-container"),t=$("#"+this.get("elementId")+" > .ember-calendar-container > .ember-calendar-body"),n=(this.get("controller.startOfDay")-this.get("controller.headingTimeRangeStart"))/(this.get("controller.headingTimeRangeEnd")-this.get("controller.headingTimeRangeStart"));e.scrollTop(n*t.height())}}}),Ember.Calendar.HeadingDateView=Ember.View.extend({templateName:"ember-calendar-head-date",classNames:["ember-calendar-head-date"],dateString:function(){return this.get("date").format(this.get("controller.headingDateFormat"))}.property("date")}),Ember.Calendar.HeadingTimesView=Ember.ContainerView.extend({classNames:["ember-calendar-head-times"],updateChildViews:function(){var e=this;e.removeAllChildren(),e.pushObjects(e.get("times").map(function(t){return e.createChildView(Ember.get(e.get("controller.headingTimeViewClass")),{time:t})}))}.observes("times"),init:function(){this._super(),this.updateChildViews()}}),Ember.Calendar.HeadingTimeView=Ember.View.extend({templateName:"ember-calendar-head-time",classNames:["ember-calendar-head-time"],timeString:function(){return moment().startOf("day").add("milliseconds",this.get("time")).format(this.get("parentView.parentView.controller.headingTimeFormat"))}.property("time")}),Ember.Calendar.DayView=Ember.ContainerView.extend({classNames:["ember-calendar-day"],updateChildViews:function(){var e=this;e.removeAllChildren(),e.pushObjects(e.get("events").map(function(t){return e.createChildView(Ember.get(e.get("parentView.controller.eventViewClass")),{event:t,parentView:e.get("parentView")})}))}.observes("events"),init:function(){this._super(),this.updateChildViews()}}),Ember.Calendar.EventView=Ember.View.extend({templateName:"ember-calendar-event",classNames:["ember-calendar-event"],attributeBindings:["style"],style:function(){if(!this.get("event"))return"";var e=moment(this.get("event.start")).valueOf(),t=moment(this.get("event.end")).valueOf(),n=moment(e).startOf("day").valueOf()+36e5*this.get("parentView.controller.headingTimeRangeStart"),a=moment(e).startOf("day").valueOf()+36e5*this.get("parentView.controller.headingTimeRangeEnd");return"top: "+100*(e-n)/(a-n)+"%; height: "+100*(t-e)/(a-n)+"%;"}.property("event","event.start","event.end"),nameString:function(){return this.get("event")?this.get("event.name"):""}.property("event","event.name"),timeString:function(){return this.get("event")?this.get("event.start").format(this.get("parentView.controller.eventTimeFormat"))+this.get("parentView.controller.eventTimeSeparator")+this.get("event.end").format(this.get("parentView.controller.eventTimeFormat")):""}.property("event","event.start","event.end"),locationString:function(){return this.get("event")&&this.get("event.location")?this.get("event.location.name")||this.get("event.location.address"):""}.property("event","event.location")}),Ember.Calendar.WeekHeadingDatesView=Ember.ContainerView.extend({classNames:["ember-calendar-head-dates"],updateChildViews:function(){var e=this;e.removeAllChildren(),e.pushObjects(e.get("dates").map(function(t){return e.createChildView(Ember.get(e.get("parentView.controller.weekHeadingDateViewClass")),{date:t})}))}.observes("dates"),init:function(){this._super(),this.updateChildViews()}}),Ember.Calendar.WeekHeadingDateView=Ember.Calendar.HeadingDateView.extend({templateName:"ember-calendar-head-date",classNames:["ember-calendar-head-week-date"],dateString:function(){return this.get("date").format(this.get("parentView.parentView.controller.headingDateFormat"))}.property("date")}),Ember.Calendar.WeekDaysView=Ember.ContainerView.extend({classNames:["ember-calendar-days"],updateChildViews:function(){var e=this;e.removeAllChildren(),e.pushObjects(e.get("days").map(function(t){return e.createChildView(Ember.get(e.get("parentView.controller.weekDayViewClass")),{events:t,parentView:e.get("parentView")})}))}.observes("days"),init:function(){this._super(),this.updateChildViews()}}),Ember.Calendar.WeekDayView=Ember.Calendar.DayView.extend({classNames:["ember-calendar-week-day"],updateChildViews:function(){var e=this;e.removeAllChildren(),e.pushObjects(e.get("events").map(function(t){return e.createChildView(Ember.get(e.get("parentView.controller.eventViewClass")),{event:t,parentView:e.get("parentView")})}))}.observes("events")});